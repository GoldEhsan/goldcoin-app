<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>GoldCoin App</title>
    
    <style>
        /* Basic Resets and Font Setup */
        :root {
            --color-bg: #111827;
            --color-card: #1f2937;
            --color-card-light: #374151;
            --color-text: #ffffff;
            --color-text-muted: #9ca3af;
            --color-primary: #facc15; /* yellow-400 */
            --color-primary-dark: #f59e0b; /* yellow-500 */
            --color-secondary: #3b82f6; /* blue-500 */
            --color-green: #22c55e; /* green-500 */
        }

        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: var(--color-bg);
            color: var(--color-text);
        }
        
        #root {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        /* Main App Container */
        .app-container {
            flex-grow: 1;
            max-width: 512px;
            margin: 0 auto;
            padding: 0.75rem;
            width: 100%;
            box-sizing: border-box;
        }

        /* Header */
        .header {
            background-color: var(--color-card);
            border-radius: 0.75rem;
            padding: 0.75rem;
            margin-bottom: 1rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .header-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--color-primary);
        }
        .header-subtitle {
            font-size: 0.75rem;
            color: var(--color-text-muted);
            margin-top: 0.25rem;
        }
        .balance-display {
            display: flex;
            align-items: center;
            justify-content: flex-end;
        }
        .balance-icon {
            width: 1.25rem;
            height: 1.25rem;
            color: var(--color-primary);
            margin-right: 0.25rem;
        }
        .balance-amount {
            font-size: 1.125rem;
            font-weight: 700;
        }

        /* Generic Card for Sections */
        .card {
            background-color: var(--color-card);
            border-radius: 1rem;
            padding: 1.5rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--color-primary);
            margin-bottom: 1.5rem;
            text-align: center;
        }

        /* Buttons */
        .button {
            width: 100%;
            padding: 0.75rem 1.5rem;
            font-weight: 700;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            transition: all 0.2s;
            border: none;
            cursor: pointer;
        }
        .button:active { transform: scale(0.95); }
        .button:disabled { background-color: #4b5563; cursor: not-allowed; }
        .button-primary { background-color: var(--color-primary-dark); color: var(--color-card); }
        .button-primary:hover { background-color: var(--color-primary); }
        .button-secondary { background-color: var(--color-secondary); color: white; }
        .button-green { background-color: var(--color-green); color: white; }

        /* Daily Spin Section */
        .spin-wheel-container {
            position: relative;
            width: 280px;
            height: 280px;
            margin: 2rem auto;
        }
        .spin-wheel {
            position: absolute;
            inset: 0;
            transition: transform 4000ms ease-out;
            border-radius: 50%;
            border: 4px solid var(--color-primary);
            overflow: hidden;
        }
        .spin-pointer {
            position: absolute;
            top: -4px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 12px solid transparent;
            border-right: 12px solid transparent;
            border-bottom: 20px solid red;
            z-index: 10;
        }
        .spin-result {
            margin-top: 1rem;
            padding: 0.75rem;
            background-color: var(--color-card-light);
            border-radius: 0.5rem;
            font-size: 1.125rem;
        }
        .spin-result-value {
            font-weight: 700;
            color: var(--color-primary);
        }

        /* Task & Game Section */
        .item-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }
        .list-item {
            padding: 1rem;
            border-radius: 0.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: var(--color-card-light);
        }
        .list-item-completed { opacity: 0.6; }
        .list-item-content { display: flex; align-items: center; }
        .list-item-icon { font-size: 1.5rem; margin-right: 1rem; }
        .list-item-title { font-weight: 600; }
        .list-item-subtitle { font-size: 0.875rem; color: var(--color-primary); }
        .list-item-button { padding: 0.5rem 1rem; font-size: 0.875rem; flex-shrink: 0; }
        .button-done { padding: 0.5rem 1rem; font-size: 0.875rem; font-weight: 700; background-color: #16a34a; color: white; border-radius: 0.5rem; }

        /* Navigation Footer */
        .footer-spacer { height: 5rem; }
        .footer { position: fixed; bottom: 0; left: 0; right: 0; background-color: var(--color-card); border-top: 1px solid var(--color-card-light); }
        .nav { max-width: 512px; margin: 0 auto; display: flex; justify-content: space-around; }
        .nav-button { flex: 1; display: flex; flex-direction: column; align-items: center; padding: 0.5rem 0.25rem; text-align: center; color: var(--color-text-muted); transition: color 0.2s; background: none; border: none; cursor: pointer; }
        .nav-button:hover { color: var(--color-green); }
        .nav-button-active { color: var(--color-primary); }
        .nav-icon { width: 1.75rem; height: 1.75rem; }
        .nav-label { font-size: 0.75rem; margin-top: 0.25rem; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">
        const { useState, useEffect, useCallback, useMemo } = React;

        const useTelegram = () => {
            const [tg, setTg] = useState(null);
            useEffect(() => {
                if (window.Telegram && window.Telegram.WebApp) {
                    const telegramApp = window.Telegram.WebApp;
                    telegramApp.ready();
                    telegramApp.expand();
                    setTg(telegramApp);
                }
            }, []);
            return tg;
        };
        
        const Icon = ({ name, className }) => {
            const icons = {
                'coin': <svg xmlns="http://www.w3.org/2000/svg" className={className} viewBox="0 0 20 20" fill="currentColor"><path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-8.707l-3-3a1 1 0 00-1.414 0l-3 3a1 1 0 001.414 1.414L9 9.414V13a1 1 0 102 0V9.414l1.293 1.293a1 1 0 001.414-1.414z" clipRule="evenodd" /></svg>,
                'spinner': <svg xmlns="http://www.w3.org/2000/svg" className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" /><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>,
                'game': <svg xmlns="http://www.w3.org/2000/svg" className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M11 4a2 2 0 114 0v1a1 1 0 001 1h3a1 1 0 011 1v3a1 1 0 01-1 1h-1a2 2 0 100 4h1a1 1 0 011 1v3a1 1 0 01-1 1h-3a1 1 0 01-1-1v-1a2 2 0 10-4 0v1a1 1 0 01-1 1H7a1 1 0 01-1-1v-3a1 1 0 00-1-1H4a2 2 0 110-4h1a1 1 0 001-1V7a1 1 0 011-1h3a1 1 0 001-1V4z" /></svg>,
                'task': <svg xmlns="http://www.w3.org/2000/svg" className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4" /></svg>,
                'wallet': <svg xmlns="http://www.w3.org/2000/svg" className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z" /></svg>,
                'friends': <svg xmlns="http://www.w3.org/2000/svg" className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M15 21a6 6 0 00-9-5.197M15 11a4 4 0 110-5.292" /></svg>,
            };
            return icons[name] || null;
        };

        const DailySpin = ({ spins, setSpins, updateBalance, tg }) => {
            const segments = useMemo(() => [
                { label: '10', value: 10 }, { label: '20', value: 20 },
                { label: '30', value: 30 }, { label: '50', value: 50 },
                { label: '5', value: 5 }, { label: '15', value: 15 },
                { label: 'MISS', value: 0 }, { label: 'MISS', value: 0 },
            ], []);
            const [isSpinning, setIsSpinning] = useState(false);
            const [rotation, setRotation] = useState(0);
            const [result, setResult] = useState(null);

            const handleSpin = () => {
                if (spins <= 0 || isSpinning) return;
                if (tg) tg.HapticFeedback.impactOccurred('medium');
                setIsSpinning(true);
                setResult(null);
                setSpins(prev => prev - 1);
                const spinAngle = Math.floor(Math.random() * 360) + 360 * 5;
                const newRotation = rotation + spinAngle;
                setRotation(newRotation);
                setTimeout(() => {
                    const segmentAngle = 360 / segments.length;
                    const finalAngle = newRotation % 360;
                    const winningIndex = Math.floor((360 - finalAngle + segmentAngle / 2) % 360 / segmentAngle);
                    const selectedSegment = segments[winningIndex];
                    setResult(selectedSegment);
                    if (selectedSegment.value > 0) {
                        updateBalance(selectedSegment.value);
                        if (tg) tg.HapticFeedback.notificationOccurred('success');
                    }
                    setIsSpinning(false);
                }, 4000);
            };
            
            const wheelBackground = `conic-gradient(${
                segments.map((seg, i) => `${i % 2 === 0 ? '#22C55E' : '#FBBF24'} ${i * (100 / segments.length)}% ${(i + 1) * (100 / segments.length)}%`).join(', ')
            })`;

            return (
                <div className="card">
                    <h2 className="section-title">Daily Spin Wheel</h2>
                    <div className="spin-wheel-container">
                        <div className="spin-pointer"></div>
                        <div className="spin-wheel" style={{ transform: `rotate(${rotation}deg)`, background: wheelBackground }}>
                            {/* Labels can be added here if needed with absolute positioning */}
                        </div>
                    </div>
                    <button onClick={handleSpin} disabled={spins <= 0 || isSpinning} className="button button-primary">
                        {isSpinning ? 'Spinning...' : `Spin Now (${spins} left)`}
                    </button>
                    {result && (
                        <div className="spin-result">
                            You landed on: <span className="spin-result-value">{result.label}</span>
                            {result.value > 0 && ` (+${result.value} Gold)`}
                        </div>
                    )}
                </div>
            );
        };

        const GameSection = ({ balance, updateBalance, tg }) => {
            const games = [
                { name: 'Backgammon', icon: '🎲' },
                { name: 'Chess', icon: '♟️' },
                { name: 'Snakes & Ladders', icon: '🐍' },
            ];
            const findMatch = (gameName) => {
                if (balance < 10) {
                    if (tg) tg.showAlert("You need at least 10 Gold to play.");
                    return;
                }
                updateBalance(-10);
                if (tg) tg.showPopup({ title: "Matchmaking", message: `Finding a ${gameName} opponent...` });
                setTimeout(() => {
                    const win = Math.random() > 0.5;
                    if (win) {
                        updateBalance(20);
                        if (tg) tg.showAlert('You won! +20 Gold');
                    } else {
                        if (tg) tg.showAlert('You lost!');
                    }
                }, 3000);
            };
            return (
                <div className="card">
                    <h2 className="section-title">Competitive Games</h2>
                    <div className="item-list">
                        {games.map(game => (
                            <div key={game.name} className="list-item">
                                <div className="list-item-content">
                                    <span className="list-item-icon">{game.icon}</span>
                                    <p className="list-item-title">{game.name}</p>
                                </div>
                                <button onClick={() => findMatch(game.name)} className="button button-green list-item-button">Play (10)</button>
                            </div>
                        ))}
                    </div>
                </div>
            );
        };
        
        const TaskSection = ({ updateBalance }) => {
            const [tasks, setTasks] = useState([
                { id: 1, title: 'Win 3 Games', reward: 100, completed: false },
                { id: 2, title: 'Join our news channel', reward: 500, completed: false },
                { id: 3, title: 'Connect your Tonkeeper wallet', reward: 100, completed: false }
            ]);
            const handleClaim = (taskId) => {
                const task = tasks.find(t => t.id === taskId);
                if (!task || task.completed) return;
                updateBalance(task.reward);
                setTasks(tasks.map(t => t.id === taskId ? {...t, completed: true} : t));
            };
            return (
                <div className="card">
                    <h2 className="section-title">Tasks & Missions</h2>
                    <div className="item-list">
                        {tasks.map(task => (
                            <div key={task.id} className={`list-item ${task.completed ? 'list-item-completed' : ''}`}>
                                <div>
                                    <p className="list-item-title">{task.title}</p>
                                    <p className="list-item-subtitle">Reward: {task.reward} Gold</p>
                                </div>
                                {task.completed ? (
                                    <span className="button-done">Done</span>
                                ) : (
                                    <button onClick={() => handleClaim(task.id)} className="button button-secondary list-item-button">Claim</button>
                                )}
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        const WithdrawalSection = () => <div className="card"><h2 className="section-title">Withdraw</h2></div>;
        const FriendSection = () => <div className="card"><h2 className="section-title">Friends</h2></div>;

        const App = () => {
            const tg = useTelegram();
            const [user, setUser] = useState(null);
            const [balance, setBalance] = useState(1950);
            const [spins, setSpins] = useState(3);
            const [activeTab, setActiveTab] = useState('spin');

            useEffect(() => {
                if (tg) setUser(tg.initDataUnsafe?.user || { first_name: 'Guest' });
            }, [tg]);

            const updateBalance = useCallback((amount) => {
                setBalance(prev => prev + amount);
            }, []);

            const tabContent = {
                spin: <DailySpin spins={spins} setSpins={setSpins} updateBalance={updateBalance} tg={tg} />,
                games: <GameSection balance={balance} updateBalance={updateBalance} tg={tg} />,
                tasks: <TaskSection updateBalance={updateBalance} />,
                withdraw: <WithdrawalSection />,
                friends: <FriendSection />,
            };

            const navItems = [
                { id: 'spin', icon: 'spinner', label: 'Spin' },
                { id: 'games', icon: 'game', label: 'Games' },
                { id: 'tasks', icon: 'task', label: 'Tasks' },
                { id: 'withdraw', icon: 'wallet', label: 'Withdraw' },
                { id: 'friends', icon: 'friends', label: 'Friends' },
            ];

            return (
                <React.Fragment>
                    <div className="app-container">
                        <header className="header">
                            <div>
                                <h1 className="header-title">GoldCoin</h1>
                                <p className="header-subtitle">Welcome, {user?.first_name || 'Guest'}</p>
                            </div>
                            <div className="balance-display">
                                <Icon name="coin" className="balance-icon" />
                                <span className="balance-amount">{balance.toLocaleString()}</span>
                            </div>
                        </header>
                        <main>{tabContent[activeTab]}</main>
                    </div>
                    <div className="footer-spacer"></div>
                    <footer className="footer">
                        <nav className="nav">
                            {navItems.map(item => (
                                <button key={item.id} onClick={() => setActiveTab(item.id)} className={`nav-button ${activeTab === item.id ? 'nav-button-active' : ''}`}>
                                    <Icon name={item.icon} className="nav-icon" />
                                    <span className="nav-label">{item.label}</span>
                                </button>
                            ))}
                        </nav>
                    </footer>
                </React.Fragment>
            );
        };

        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(<App />);
    </script>
</body>
</html>