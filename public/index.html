<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>GoldCoin App</title>
    
    <style>
        /* All previous CSS styles remain the same */
        :root { /* ... */ }
        body { margin: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background-color: #111827; color: #ffffff; }
        /* ... All other styles from before ... */

        /* Styles for the new Full-Screen Game Viewer */
        .game-viewer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #000;
            z-index: 1000;
            display: flex;
            flex-direction: column;
        }
        .game-viewer-header {
            padding: 0.5rem;
            background-color: #1f2937;
            display: flex;
            justify-content: flex-end;
            flex-shrink: 0;
        }
        .game-viewer-iframe {
            flex-grow: 1;
            border: none;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">
        const { useState, useEffect, useCallback, useMemo } = React;

        // --- All utility hooks and components like useTelegram, Icon, etc. remain the same ---
        const useTelegram = () => { /* ... */ 
            const [tg, setTg] = useState(null);
            useEffect(() => {
                if (window.Telegram && window.Telegram.WebApp) {
                    const telegramApp = window.Telegram.WebApp;
                    telegramApp.ready();
                    telegramApp.expand();
                    setTg(telegramApp);
                }
            }, []);
            return tg;
        };
        const Icon = ({ name, className }) => { /* ... */
            const icons = { 'coin': <svg xmlns="http://www.w3.org/2000/svg" className={className} viewBox="0 0 20 20" fill="currentColor"><path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-8.707l-3-3a1 1 0 00-1.414 0l-3 3a1 1 0 001.414 1.414L9 9.414V13a1 1 0 102 0V9.414l1.293 1.293a1 1 0 001.414-1.414z" clipRule="evenodd" /></svg>, 'spinner': <svg xmlns="http://www.w3.org/2000/svg" className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" /><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>, 'game': <svg xmlns="http://www.w3.org/2000/svg" className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M11 4a2 2 0 114 0v1a1 1 0 001 1h3a1 1 0 011 1v3a1 1 0 01-1 1h-1a2 2 0 100 4h1a1 1 0 011 1v3a1 1 0 01-1 1h-3a1 1 0 01-1-1v-1a2 2 0 10-4 0v1a1 1 0 01-1 1H7a1 1 0 01-1-1v-3a1 1 0 00-1-1H4a2 2 0 110-4h1a1 1 0 001-1V7a1 1 0 011-1h3a1 1 0 001-1V4z" /></svg>, 'task': <svg xmlns="http://www.w3.org/2000/svg" className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4" /></svg>, 'wallet': <svg xmlns="http://www.w3.org/2000/svg" className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z" /></svg>, 'friends': <svg xmlns="http://www.w3.org/2000/svg" className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M15 21a6 6 0 00-9-5.197M15 11a4 4 0 110-5.292" /></svg>, };
            return icons[name] || null;
        };

        // --- All Section Components (DailySpin, TaskSection, etc.) remain the same ---
        const DailySpin = ({ spins, setSpins, updateBalance, tg }) => { /* ... same as before ... */
            const segments = useMemo(() => [ { label: '10', value: 10 }, { label: 'MISS', value: 0 }, { label: '20', value: 20 }, { label: '5', value: 5 }, { label: '50', value: 50 }, { label: 'MISS', value: 0 }, { label: '30', value: 30 }, { label: '15', value: 15 } ], []);
            const [isSpinning, setIsSpinning] = useState(false);
            const [rotation, setRotation] = useState(0);
            const [result, setResult] = useState(null);
            const handleSpin = () => { if (spins <= 0 || isSpinning) return; if (tg) tg.HapticFeedback.impactOccurred('medium'); setIsSpinning(true); setResult(null); setSpins(prev => prev - 1); const spinAngle = Math.floor(Math.random() * 360) + 360 * 6; const newRotation = rotation + spinAngle; setRotation(newRotation); setTimeout(() => { const segmentAngle = 360 / segments.length; const finalAngle = newRotation % 360; const winningIndex = Math.floor((360 - finalAngle + segmentAngle / 2) % 360 / segmentAngle); const selectedSegment = segments[winningIndex]; setResult(selectedSegment); if (selectedSegment.value > 0) { updateBalance(selectedSegment.value); if (tg) tg.HapticFeedback.notificationOccurred('success'); } setIsSpinning(false); }, 4000); };
            const SvgWheel = ({ segments }) => { const radius = 100; const getCoords = (percent) => [Math.cos(2 * Math.PI * percent) * radius, Math.sin(2 * Math.PI * percent) * radius]; const segmentAngle = 1 / segments.length; return ( <g transform="rotate(-90)"> {segments.map((segment, i) => { const [startX, startY] = getCoords(i * segmentAngle); const [endX, endY] = getCoords((i + 1) * segmentAngle); const path = `M ${startX} ${startY} A ${radius} ${radius} 0 0 1 ${endX} ${endY} L 0 0`; const textAngleInRadians = (i + 0.5) * segmentAngle * 2 * Math.PI; const textX = Math.cos(textAngleInRadians) * radius * 0.65; const textY = Math.sin(textAngleInRadians) * radius * 0.65; const textRotation = (textAngleInRadians * 180 / Math.PI) + 90; return ( <g key={i}> <path d={path} fill={i % 2 === 0 ? "var(--color-green)" : "var(--color-primary)"} /> <g transform={`rotate(${textRotation} ${textX} ${textY})`}> <text x={textX} y={textY} className="wheel-svg-text">{segment.label}</text> </g> </g> ); })} </g> ); };
            return ( <div className="card"> <h2 className="section-title">Daily Spin Wheel</h2> <div className="spin-wheel-container"> <div className="spin-pointer"></div> <div className="spin-wheel" style={{ transform: `rotate(${rotation}deg)` }}> <svg viewBox="-105 -105 210 210" width="280" height="280"><SvgWheel segments={segments} /></svg> </div> </div> <button onClick={handleSpin} disabled={spins <= 0 || isSpinning} className="button button-primary">{isSpinning ? 'Spinning...' : `Spin Now (${spins} left)`}</button> {result && (<div className="spin-result">You landed on: <span className="spin-result-value">{result.label}</span> {result.value > 0 && ` (+${result.value} Gold)`} </div>)} </div> );
        };
        const TaskSection = ({ updateBalance, tasks, setTasks }) => { /* ... */ 
            const handleClaim = (taskId) => { const task = tasks.find(t => t.id === taskId); if (!task || task.completed) return; updateBalance(task.reward); setTasks(prevTasks => prevTasks.map(t => t.id === taskId ? {...t, completed: true} : t)); };
            return ( <div className="card"> <h2 className="section-title">Tasks & Missions</h2> <div className="item-list"> {tasks.map(task => ( <div key={task.id} className={`list-item ${task.completed ? 'list-item-completed' : ''}`}> <div className="list-item-details"> <p className="list-item-title">{task.title}</p> <p className="list-item-subtitle">Reward: {task.reward} Gold</p> </div> {task.completed ? <span className="button-done">Done</span> : <button onClick={() => handleClaim(task.id)} className="button button-secondary button-small">Claim</button>} </div> ))} </div> </div> );
        };
        const WithdrawalSection = ({ tg }) => { /* ... */ 
            const [page, setPage] = useState('main'); const VIP_WALLET_ADDRESS = "YOUR_WALLET_ADDRESS_HERE"; const VIP_FEE_TON = 0.5;
            const handleVipPayment = () => { const amountInNanoTon = VIP_FEE_TON * 1_000_000_000; const deepLink = `ton://transfer/${VIP_WALLET_ADDRESS}?amount=${amountInNanoTon}&text=vip-activation`; if (tg && tg.openLink) { tg.openLink(deepLink); } else { window.location.href = deepLink; } };
            if (page === 'vip_info') { return ( <div className="card" style={{textAlign: "center"}}> <h2 className="section-title">VIP Activation</h2> <p style={{color: "var(--color-text-muted)", margin: "0 auto 2rem auto", lineHeight: 1.6}}>Pay {VIP_FEE_TON} TON to activate your VIP status and unlock withdrawals.</p> <button className="button button-primary" onClick={handleVipPayment}>Pay with Tonkeeper</button> <button className="button button-link" onClick={() => setPage('main')}>Back</button> </div> ); }
            return ( <div className="card"> <h2 className="section-title">Withdrawals</h2> <div className="info-box"> <p>Free Withdrawal</p> <p style={{color: "var(--color-text-muted)", fontSize: "0.875rem"}}>Temporarily closed.</p> </div> <div className="info-box" style={{backgroundColor: "var(--color-primary-dark)"}}> <p style={{fontWeight: "bold"}}>VIP Withdrawal</p> <p style={{fontSize: "0.875rem"}}>Activate VIP to withdraw up to 30,000 Gold.</p> </div> <button className="button button-secondary" style={{marginTop: "1rem"}} onClick={() => setPage('vip_info')}>Activate VIP</button> </div> );
        };
        const FriendSection = ({ tg, user }) => { /* ... */ 
             const inviteLink = user ? `https://t.me/YourBot?start=${user.id}` : 'Loading...';
            const copyLink = () => { navigator.clipboard.writeText(inviteLink).then(() => { if(tg) tg.showAlert('Invite link copied!'); }); };
            return ( <div className="card"> <h2 className="section-title">Invite Friends</h2> <p style={{textAlign: 'center', color: 'var(--color-text-muted)'}}>Get an extra spin for each friend who joins!</p> <div className="invite-link-box"> <span className="invite-link-text">{inviteLink}</span> <button className="button button-primary button-small" onClick={copyLink}>Copy</button> </div> <div className="info-box"> <p style={{fontWeight: 'bold', fontSize: '1.2rem'}}>0 Friends</p> <p>Invited</p> </div> </div> );
        };

        // --- MODIFIED GameSection ---
        const GameSection = ({ launchGame }) => {
            // IMPORTANT: Replace these with actual URLs to web-based games
            const games = [
                { name: 'Backgammon', icon: '🎲', url: 'https://www.247backgammon.org/' }, 
                { name: 'Chess', icon: '♟️', url: 'https://www.chess.com/play/computer' },
                { name: 'Snakes & Ladders', icon: '🐍', url: 'https://www.plays.org/snakes-and-ladders-multiplayer/' }
            ];
            
            return ( <div className="card"> <h2 className="section-title">Competitive Games</h2> <div className="item-list"> {games.map(game => ( <div key={game.name} className="list-item"> <div className="list-item-content"> <span className="list-item-icon">{game.icon}</span> <div className="list-item-details"> <p className="list-item-title">{game.name}</p> </div> </div> <button onClick={() => launchGame(game.url)} className="button button-green button-small">Play</button> </div> ))} </div> </div> );
        };

        // --- NEW GameViewer Component ---
        const GameViewer = ({ url, onClose }) => {
            return (
                <div className="game-viewer">
                    <div className="game-viewer-header">
                        <button className="button button-small" style={{backgroundColor: "var(--color-red)"}} onClick={onClose}>
                            Close Game
                        </button>
                    </div>
                    <iframe className="game-viewer-iframe" src={url} title="Game"></iframe>
                </div>
            );
        };

        const App = () => {
            const tg = useTelegram();
            const [user, setUser] = useState(null);
            const [balance, setBalance] = useState(1950);
            const [spins, setSpins] = useState(3);
            const [tasks, setTasks] = useState([ { id: 1, title: 'Win 3 Games', reward: 100, completed: false }, { id: 2, title: 'Join news channel', reward: 500, completed: false } ]);
            const [activeTab, setActiveTab] = useState('games');
            
            // --- NEW STATE FOR GAME LAUNCHER ---
            const [activeGameUrl, setActiveGameUrl] = useState(null);

            useEffect(() => {
                if (tg) setUser(tg.initDataUnsafe?.user || { id: '12345', first_name: 'Guest' });
            }, [tg]);

            const updateBalance = useCallback((amount) => setBalance(prev => prev + amount), []);
            
            const launchGame = (url) => {
                // You can add logic here to deduct coins before launching
                updateBalance(-10);
                setActiveGameUrl(url);
            };

            const closeGame = () => {
                setActiveGameUrl(null);
                // You can add logic here to award coins after a game
            };

            const tabContent = {
                spin: <DailySpin spins={spins} setSpins={setSpins} updateBalance={updateBalance} tg={tg} />,
                games: <GameSection launchGame={launchGame} />,
                tasks: <TaskSection updateBalance={updateBalance} tasks={tasks} setTasks={setTasks} />,
                withdraw: <WithdrawalSection tg={tg} />,
                friends: <FriendSection tg={tg} user={user} />,
            };

            const navItems = [ { id: 'spin', icon: 'spinner', label: 'Spin' }, { id: 'games', icon: 'game', label: 'Games' }, { id: 'tasks', icon: 'task', label: 'Tasks' }, { id: 'withdraw', icon: 'wallet', label: 'Withdraw' }, { id: 'friends', icon: 'friends', label: 'Friends' }, ];

            return (
                <React.Fragment>
                    {activeGameUrl && <GameViewer url={activeGameUrl} onClose={closeGame} />}
                    
                    <div style={{ display: activeGameUrl ? 'none' : 'block' }}>
                        <div className="app-container">
                            <header className="header">
                                <div> <h1 className="header-title">GoldCoin</h1> <p className="header-subtitle">Welcome, {user?.first_name || ''}</p> </div>
                                <div className="balance-display"> <Icon name="coin" className="balance-icon" /> <span className="balance-amount">{balance.toLocaleString()}</span> </div>
                            </header>
                            <main>{tabContent[activeTab]}</main>
                        </div>
                        <div className="footer-spacer"></div>
                        <footer className="footer">
                            <nav className="nav">
                                {navItems.map(item => (
                                    <button key={item.id} onClick={() => setActiveTab(item.id)} className={`nav-button ${activeTab === item.id ? 'nav-button-active' : ''}`}>
                                        <Icon name={item.icon} className="nav-icon" />
                                        <span className="nav-label">{item.label}</span>
                                    </button>
                                ))}
                            </nav>
                        </footer>
                    </div>
                </React.Fragment>
            );
        };

        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(<App />);
    </script>
</body>
</html>